class ChatEngine{constructor(e,s,a,t){this.chatBoxId=$("."+e),this.userEmail=s,this.name=a,this.id=t,this.cnt=0,this.socket=io.connect("http://localhost:5000"),this.userEmail&&this.connectionHandler()}connectionHandler(){let e=this;this.socket.on("connect",(function(){console.log("connection established using socket...!"),e.socket.emit("join",{email:e.userEmail});let s={};$.ajax({type:"get",url:"message/get-messages",success:function(a){console.log(a.messages.message);for(let t of a.messages.message)if(t.from_user==e.id){let e={msg:t.msg,val:1};s[t.to_user]||(s[t.to_user]=[]),s[t.to_user].push(e)}else{let e={msg:t.msg,val:2};s[t.from_user]||(s[t.from_user]=[]),s[t.from_user].push(e)}console.log(s);let t=$(".friend");for(let a of t)$(a).click((function(t){e.cnt=0;let o=0,n=$("#friend-chat-box");$(n).removeClass("hide-box"),$(n).addClass("chat-box"),$("#chat-box-body").text("");let l=$(a).attr("data-email"),c=$(a).attr("data-id"),m=$(a).attr("data-name");if(s[c])for(let e of s[c]){let s=$("<div>"),a="others-message";1===e.val&&(a="my-message"),$(s).append($("<span>",{html:e.msg})),$(s).addClass(a),$("#chat-box-body").append(s)}$(".chat-box-name").text(""),$(".chat-box-name").append(m),console.log(l),$("#message-send").click((function(a){a.preventDefault(),a.stopPropagation();let t=$("#chat-message").val();$("#chat-message").val(""),""!=t&&$.ajax({type:"get",url:`message/create/?id=${c}&msg=${t}`,success:function(a){console.log(a),0==e.cnt?(e.cnt=1,o=1):o=0,e.socket.emit("send_message",{message:t,userEmail:e.userEmail,chatRoom:l,name:e.name,flag:o,oldMsg:s[c],id:e.id})},error:function(e){console.log(e.responseText)}})}))}))},error:function(e){console.log(e.responseText)}}),e.socket.on("recieve_message",(function(s){console.log(s.message);let a=$("<div>"),t="others-message";e.userEmail==s.userEmail&&(t="my-message"),$(a).append($("<span>",{html:s.message})),$(a).addClass(t),$("#chat-box-body").append(a)})),e.socket.on("open_message_box",(function(s){if(s.chatRoom==e.userEmail){let a=$("#friend-chat-box");$(a).removeClass("hide-box"),$(a).addClass("chat-box");let t=s.userEmail,o=s.name;s.name!==e.name&&1==s.flag&&($(".chat-box-name").text(""),$(".chat-box-name").append(o),s.flag=0);for(let e of s.oldMsg){let s=$("<div>"),a="others-message";2===e.val&&(a="my-message"),$(s).append($("<span>",{html:e.msg})),$(s).addClass(a),$("#chat-box-body").append(s)}console.log(t),$("#message-send").click((function(a){a.preventDefault(),a.stopPropagation(),e.cnt=1;let o=$("#chat-message").val();$("#chat-message").val(""),""!=o&&$.ajax({type:"get",url:`message/create/?id=${s.id}&msg=${o}`,success:function(s){console.log(s),e.socket.emit("send_message",{message:o,userEmail:e.userEmail,chatRoom:t,flag:s.flag})},error:function(e){console.log(e.responseText)}})}))}}))}))}}